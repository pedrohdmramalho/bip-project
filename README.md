# Balance (Mindful Journey)

Mindfulness and meditation Flutter app with mood tracking, guided sessions, music recommendations, daily reflections, analytics, and gentle daily reminders. Backed by Firebase for auth, storage, and data, and integrates the Freesound API for ambient music.

App package: `starteu` • Target platforms: Android, iOS, Web, Windows, macOS (Firebase options generated).

## Features

- Google Sign‑In: Firebase Authentication with Google.
- Mood tracking: Daily check-in, streak counter, last 7 days chart.
- Meditation sessions: Breathing animation, configurable timer, session logging to Firestore.
- Music library: Category browsing (Sleep/Anxiety/Focus/Chill/Meditation) with searchable Freesound tracks and playback.
- Daily reflections: Journal entries saved to Firestore with mood and text.
- Notifications: Local daily reminder (Android/iOS) via `flutter_local_notifications`.
- Profile: View info, upload/remove profile picture (Firebase Storage).
- Theming: Light/Dark/System mode persisted with `shared_preferences`.

## Tech Stack

- Flutter (Material 3), Dart (SDK constraint: ^3.9.2)
- State management: BLoC (`flutter_bloc`) + Provider (`ChangeNotifier` for theme)
- Firebase: `firebase_core`, `firebase_auth`, `cloud_firestore`, `firebase_storage`
- Media: `audioplayers` for audio playback
- Charts: `fl_chart` for mood trends
- Notifications: `flutter_local_notifications`, `timezone`
- Other: `intl`, `image_picker`, `shared_preferences`, `google_sign_in`

## Architecture Overview

- Entry: [lib/main.dart](lib/main.dart)
	- Initializes Firebase using [lib/firebase_options.dart](lib/firebase_options.dart) (generated by FlutterFire CLI)
	- Sets up theme via `ThemeModeManager`
	- Provides `MoodBloc` and routes (e.g., `/meditation`)
	- Initializes and schedules local notifications via [lib/services/notification_service.dart](lib/services/notification_service.dart)
- Auth: [lib/auth/services/auth_service.dart](lib/auth/services/auth_service.dart)
	- `FirebaseAuthService` implements Google Sign‑In and sign out
- Data
	- Repositories: [lib/data/repositories](lib/data/repositories)
		- `MoodRepository`: read/write moods to Firestore
		- `MeditationRepository`: exercises, session history, analytics
		- `DailyReflectionRepository`: save daily reflections
	- Models: [lib/data/models](lib/data/models)
- State
	- Mood BLoC: [lib/bloc/mood_bloc.dart](lib/bloc/mood_bloc.dart)
	- Daily Reflection BLoC: [lib/bloc/daily_reflection_bloc.dart](lib/bloc/daily_reflection_bloc.dart)
- UI Pages: [lib/pages](lib/pages)
	- `MainNavigationPage`: bottom tabs (Home, Library, Meditate, Profile)
	- `MyHomePage`: mood selection, recommendations, entry points to analytics/notifications
	- `LibraryPage`: music browsing & playback, Freesound integration
	- `MeditationPage`: breathing animation, timer, music player, session lifecycle
	- `StatisticsPage` (TestPage): mood chart + meditation calendar heatmap
	- `ProfilePage`: photo upload (Storage), theme selection
	- `DailyReflectionPage`: mood + journal text saved to Firestore
- Services
	- Notifications: [lib/services/notification_service.dart](lib/services/notification_service.dart)
	- Theme: [lib/config/theme_mode_manager.dart](lib/config/theme_mode_manager.dart)
	- API keys: [lib/config/api_keys.dart](lib/config/api_keys.dart) (Freesound)

## Data Model & Firestore Collections

- Users’ moods: `users/{userId}/moods/{yyyy-MM-dd}` → `{ label, date, timestamp }`
- Meditation history: `users/{userId}/meditation_history` → `{ title, duration, date, timestamp }`
- Daily reflections: `daily_reflections` → `{ mood, text, createdAt }`

Note: Some repositories currently use a placeholder `user_123`. For production, wire repositories to the authenticated user’s `uid` from `FirebaseAuth`.

## Project Structure (high-level)

```
lib/
	main.dart
	firebase_options.dart
	auth/
		services/
		screens/
	bloc/
	config/
	data/
		repositories/
		models/
		datasource/
	pages/
	services/
	widgets/
assets/
```

## Prerequisites

- Flutter 3.24+ (Dart 3.9.x)
- Firebase project (Web/Android/iOS/MacOS/Windows as needed)
- Android Studio and/or Xcode toolchains

Verify your setup:

```bash
flutter doctor -v
```

## Setup

1) Install dependencies

```bash
flutter pub get
```

2) Firebase configuration

- The repo includes generated options in [lib/firebase_options.dart](lib/firebase_options.dart).
- Android: `android/app/google-services.json` is present.
- iOS/macOS: Ensure `GoogleService-Info.plist` is added to the iOS/macOS targets and bundle id matches (`com.example.starteu` by default). If you change the bundle id or add platforms, re-run FlutterFire CLI:

```bash
dart pub global activate flutterfire_cli
flutterfire configure
```

3) Freesound API key

- This repository does not ship an API key. Create your own key at https://freesound.org/apiv2/apply/ and configure it locally.
- Create the file `lib/config/api_keys.dart` if it does not exist, and paste:

```dart
class ApiKeys {
	static const String freesoundApiKey = 'REPLACE_WITH_YOUR_KEY';
}
```

- Important: do not commit this file. Add an ignore rule if needed:

```gitignore
lib/config/api_keys.dart
```

- Alternative: you can manage secrets via environment/CI (e.g., `--dart-define`) after refactoring the code to read from `String.fromEnvironment`.

4) Notifications

- Android 13+: runtime notifications permission is requested by `NotificationService`.
- iOS: notifications require user permission and proper capabilities; review iOS notification settings and Info.plist if needed.
- Default reminder time is set in [notification_service.dart](lib/services/notification_service.dart) (`scheduleDailyMeditationReminder`). Adjust as needed.

5) App icons (optional)

Configured via `flutter_launcher_icons` using assets at `assets/icon/app_logo.png`.

```bash
flutter pub run flutter_launcher_icons
```

## Run

```bash
flutter run
```

To target a specific device:

```bash
flutter devices
flutter run -d <device_id>
```

## Key Workflows

- Sign‑in: Google sign‑in flows through `FirebaseAuthService` and `AuthGate` in `main.dart`.
- Mood: Home screen lets users select a mood, persists to Firestore, updates streak and weekly chart.
- Music: Library fetches category-based tracks from Freesound and streams via `audioplayers`.
- Meditation: Session with breathing animation, timer, optional music; on completion logs to `meditation_history`.
- Daily Reflection: Compose mood and text and save to `daily_reflections`.
- Notifications: Local daily reminder scheduled on app start.
- Profile: Upload/remove avatar to Storage, change theme mode (persisted).

## Troubleshooting

- Build fails after dependency changes: `flutter clean && flutter pub get`
- Android Gradle issues: update Android Gradle Plugin/Wrapper via Android Studio if needed.
- Firebase errors: ensure platform configs are valid and bundle ids match Firebase apps.
- Notifications not showing on Android 13+: verify runtime permission is granted in App Info.
- iOS notifications: verify capabilities and notification permissions in Info.plist/Settings.
- Missing Freesound audio: ensure API key is valid and network is available.

## Notes & Limitations

- `MoodRepository` uses a placeholder `userId = "user_123"`; replace with the authenticated user’s `uid`.
- Some strings/UI labels are prototype-quality; adjust for localization and UX.
- Consider moving API keys out of source and tightening Firebase Security Rules before production.

---

For Flutter best practices and APIs, see the official [Flutter documentation](https://docs.flutter.dev/).
